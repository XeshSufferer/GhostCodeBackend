### Notification Service

## SignalR Hub

### Подключение к Hub

**Endpoint**: `/notifications`

**Требования**: 
- **Auth**: Требуется валидный JWT токен
- Подключение через SignalR WebSocket

**Пример подключения (JavaScript)**:
```javascript
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/notifications", {
        accessTokenFactory: () => jwtToken
    })
    .build();
```

---

## Автоматические события

### OnConnected

При подключении к Hub:
- Пользователь автоматически регистрируется в системе для получения уведомлений
- Его connectionId сохраняется в кеше
- Все последующие уведомления будут отправляться в реальном времени

### OnDisconnected

При отключении от Hub:
- Пользователь автоматически удаляется из списка активных подключений
- Уведомления будут накапливаться и отправлены при следующем подключении

---

## Получение уведомлений

### Событие: NotificationReceived

**Автоматическая отправка**: Уведомления отправляются автоматически при их создании в системе

**Формат уведомления**:
```
{
  "title": "string",
  "message": "string",
  "type": "Info" | "Warning" | "Danger" | "Success" | "Error"
}
```

**Типы уведомлений**:
- `Info` - Информационное уведомление
- `Warning` - Предупреждение
- `Danger` - Опасность
- `Success` - Успешная операция
- `Error` - Ошибка

**Пример обработки на клиенте**:
```javascript
connection.on("NotificationReceived", (notification) => {
    console.log(`[${notification.type}] ${notification.title}: ${notification.message}`);
    // Отобразить уведомление пользователю
});
```

---

## Отправка уведомлений

**Примечание**: Уведомления отправляются через внутренний RPC механизм (RabbitMQ), а не через HTTP API

Уведомления создаются другими сервисами системы и автоматически доставляются пользователям через SignalR Hub.

**Пример создания уведомления (внутренний механизм)**:
- Другие сервисы отправляют запрос через RabbitMQ
- NotificationService обрабатывает запрос и отправляет уведомление через SignalR
- Если пользователь онлайн - уведомление доставляется мгновенно
- Если пользователь офлайн - уведомление сохраняется для доставки при подключении

---

## Rate Limits ⚡

- **Глобальный лимит**: 5 запросов в минуту
- **При превышении**: таймаут на 10 минут

### Важные замечания:
- Rate limiting применяется к подключениям и операциям Hub
- Подключение к Hub требует валидный JWT токен
- При истечении токена соединение будет разорвано
- Рекомендуется реализовать переподключение на клиенте при потере соединения
- Уведомления доставляются только авторизованным пользователям

